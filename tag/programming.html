<!DOCTYPE html>
<html lang="en">
<head>
        <title>A Blog - Programming</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
<a href="https://github.com/we-taper">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="">A Blog  <strong>about Coding.</strong></a></h1>
                <nav>
                    <a href="/pages/who-am-i.html">Who am I?</a>&nbsp;
                    <a href="/category/blogging.html">Blogging</a>&nbsp;
                    <a href="/category/computer_tips.html">Computer_Tips</a>&nbsp;
                    <a href="/category/coursenote.html">CourseNote</a>&nbsp;
                    <a href="/category/programming.html">Programming</a>&nbsp;
                </nav>
        </header><!-- /#banner -->
        
        

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/assertion-another-way-to-commment-debug.html">Assertion - Another Way to Commment & Debug</a></h1> 
<footer class="post-info">
        <abbr class="published" title="2014-04-17T00:00:00">
                周四 17 四月 2014
        </abbr>
<p>tags: <a href="/tag/java.html">Java</a><a href="/tag/programming.html">Programming</a><a href="/tag/unfinished.html">unFinished</a><a href="/tag/unpolished.html">unPolished</a></p></footer><!-- /.post-info --><p>Assertion is a claim, which says that you believe something must be true. In Programming, it acts as an check of the status of something. For example, if you want to find the maximum value of an <code>int[]</code> array, you should make sure that is index lies within the range. So:</p>
<div class="highlight"><pre><span class="n">assert</span> <span class="nf">withinRange</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
</pre></div>


<p>Now, you can proceed to the next process with confidence.</p>
<h2>0. Enable assertion</h2>
<p>When you write assert in your java code, java compiler will compile them into binary code file <em>.class</em>. However, JVM does run this code by default. This is because assertion is designed for programmers to debug and comment on their code. It is not intended to be produce effect on published program. Therefore, by default assertion is disabled in JVM to prevent end user from seeing them. Before we use assert in our program, we must first enable it. We should enable them by passing <code>"-enableassertion"</code> or <code>"-ea"</code> option to JVM. E.g.:</p>
<div class="highlight"><pre><span class="n">java</span> <span class="o">-</span><span class="n">ea</span> <span class="n">ClassName</span>
</pre></div>


<h2>1. The Grammar</h2>
<p>Syntax for assertion is:</p>
<div class="highlight"><pre><span class="n">assert</span> <span class="n">Exp1</span><span class="p">;</span>
</pre></div>


<p>or</p>
<div class="highlight"><pre><span class="n">assert</span> <span class="n">Exp1</span><span class="o">:</span><span class="n">Exp2</span><span class="p">;</span>
</pre></div>


<p>Here, <code>Exp1</code> is the condition that you want to check and will return a boolean value. If the boolean is true, program proceeds normally. However, if your assertion is wrong and <code>Exp1</code> returns false, program stops immediately and there will be an <code>AssertionError</code> thrown with message provided by <code>Exp2</code> (if available). Now, you can deal with this error with the message provided by <code>Exp2</code>.</p>
<h2>2. An Example</h2>
<p>Here's a case. I want to write a program to add two binary number of equal length together.</p>
<p>Here's a pesudo-code of my algorithm:</p>
<div class="highlight"><pre><span class="n">Input</span> <span class="n">two</span> <span class="n">array</span> <span class="n">representing</span> <span class="n">the</span> <span class="n">two</span> <span class="n">integers</span>
<span class="n">Suppose</span> <span class="n">the</span> <span class="n">two</span> <span class="n">array</span> <span class="n">are</span> <span class="n">legal</span> <span class="n">binary</span> <span class="n">numbers</span> <span class="n">of</span> <span class="n">equal</span> <span class="n">size</span><span class="p">.</span>
<span class="n">pre</span> <span class="o">=</span> <span class="mi">0</span> <span class="err">#</span> <span class="n">Here</span> <span class="n">carries</span> <span class="n">the</span> <span class="n">calculation</span> <span class="n">carried</span> <span class="n">by</span> <span class="n">previous</span> <span class="n">calculation</span><span class="p">.</span>
<span class="n">now</span> <span class="err">#</span> <span class="n">Carries</span> <span class="n">number</span> <span class="n">in</span> <span class="n">this</span> <span class="n">calculation</span><span class="p">.</span>
<span class="k">while</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="cm">/*</span>
<span class="cm">     * Note: </span>
<span class="cm">     * sum  now pre </span>
<span class="cm">     * 1    1   0</span>
<span class="cm">     * 2    0   1</span>
<span class="cm">     * 3    1   1</span>
<span class="cm">     * Clearly: </span>
<span class="cm">     * now = sum % 2 </span>
<span class="cm">     * pre = sum / 2</span>
<span class="cm">     */</span>
    <span class="n">now</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pre</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">pre</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pre</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="p">;</span>
    <span class="n">index</span><span class="o">--</span><span class="p">;</span>
<span class="cp"># Now I should be sure that index has reached 0 -- the beggining of nmber.</span>
<span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">;</span>
<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</pre></div>


<p>In this code, I have many <em>preconditions</em> and <em>postconditions</em>. I should take care of this conditions otherwise my code would not run properly. So how do I check this conditions? One may use <code>if</code> to test and run your code only <code>if</code>'s condition is correct. However, some of this check isn't necessary in client program (some of them are used only to check whether programmer have correctly write his code). This code will have effect ont your client -- possibly reduce the efficiency. So what to do now:</p>
<ol>
<li>Remove the code after you code after debug or</li>
<li>Using assertion</li>
</ol>
<p>Solution one is plausible in small applications. But in a large scale program, it is almost impossible to note down all this ifs and remove them after debuggin. It's best to write this code using java assertions because they <strong>DO NOT</strong> run if client does not enable assertion in JVM. Thus, <em>it has no side effect on published program.</em></p>
<p>Here's my solution:</p>
<div class="highlight"><pre><span class="n">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">addBinaryNumberOrg</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">assert</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span> <span class="o">&amp;&amp;</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">:</span> <span class="s">&quot;a:&quot;</span> <span class="o">+</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">+</span> <span class="s">&quot;b:&quot;</span>
            <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="c1">// case 1</span>
    <span class="c1">// assert a is 1 / 0, b is 1 / 0. case 2</span>
    <span class="kt">int</span> <span class="n">pre</span><span class="p">;</span> <span class="c1">// Number carried in previous calculation.</span>
    <span class="n">pre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">now</span><span class="p">;</span> <span class="c1">// Number in this calculation.</span>
    <span class="kt">int</span><span class="p">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="n">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">now</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pre</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">pre</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pre</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="p">;</span>
        <span class="n">index</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">assert</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">:</span> <span class="s">&quot;i:&quot;</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span> <span class="c1">// case 3</span>
    <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Here I use asser three times (2 + 1). But we can cleary see that case 1 and 2 should throw an <code>IllegalArgumentException</code>. But case 3 is clearly something should be and only be checked when developming the program. So here's my final code:</p>
<div class="highlight"><pre><span class="n">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">addBinaryNumber</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Different length: a:&quot;</span><span class="o">+</span><span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="o">+</span><span class="s">&quot; b:&quot;</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">throw</span> <span class="n">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Not a binary number a:&quot;</span><span class="o">+</span><span class="n">Arrays</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="p">(</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">throw</span> <span class="n">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Not a binary number b:&quot;</span><span class="o">+</span><span class="n">Arrays</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="cm">/** Number carried in previous calculation. */</span>
    <span class="kt">int</span> <span class="n">carriedFromPre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span><span class="p">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="n">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">carriedFromPre</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">carriedFromPre</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">carriedFromPre</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">index</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">carriedFromPre</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h2>3. Why Using Assertion</h2>
<h3>Quick Prototype</h3>
<p>Using assertions to quickly write down your thoughts and turn them into code. Forget about the code to check the pre-conditions and post-conditions, just writen them inside assert block. Now you can run your code on the fly! Althought it may broke down for several times, the message inside <code>AssertionError</code> will provide you with enough information to debug, change and run your code again. This effectively speed up the development process, free your mind from caring about the pitifal of your code.</p>
<h3>Commenting</h3>
<p>Sometimes your want to comment some special situations in your code, like:</p>
<div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// process a;</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="c1">// a &lt;= b</span>
<span class="p">}</span>
</pre></div>


<p>Now your have a choose of using assertion:</p>
<div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// process a;</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="n">assert</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span> <span class="o">:</span> <span class="s">&quot;A: &quot;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">&quot;B: &quot;</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p><strong>What is the benefit?</strong></p>
<p>Wow, adding a new keyword in Java just to introduce a new way of commenting? Yeah, it may not be so obvious but ......</p>
<h1>To Be Continued</h1>
<h2>Reference</h2>
<p>1.<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/language/assert.html">Oracle Java SE Documentation</a></p><p>There are <a href="/assertion-another-way-to-commment-debug.html#disqus_thread">comments</a>.</p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://ovelinux.blog.sohu.com/">My Previous Blog</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="we.taper[WhateverInsideIsUseless]qq.com">My E-Mail (Don't click, copy link and alter it to correct form, thx)</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                     Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>. Theme is using <a href="http://github.com/getpelican/pelican-themes" target="_blank">cebong</a>.
                </address><!-- /#about -->

        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'taper';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>